{"uid":"60b5b7dedd7454f9","name":"test_method[批量删除角色 01]","fullName":"testcases.test_A.test_role.test_deleteRole.TestCaseCommon#test_method","historyId":"c23bd3a2de404f50c998e4597ac72c79","time":{"start":1686643274616,"stop":1686643275094,"duration":478},"status":"failed","statusMessage":"AssertionError: assert '角色编号集合不允许为空' == '操作成功'\n  - 操作成功\n  + 角色编号集合不允许为空","statusTrace":"self = <testcases.test_A.test_role.test_deleteRole.TestCaseCommon object at 0x000002406DEEB750>\nkwargs = {'apis': [{'assert': [{'expect': 200, 'type': 'status'}, {'expect': '操作成功', 'name': 'message', 'type': 'sys'}], 'data'...name': '批量删除角色 01', 'teardown': [{'sqls': 'update ums_role set is_delete = 0 where id = 6 or id = 7', 'type': 'db'}]}]}\nmy_fixture = None\n\n    @allure.feature(\"测试接口\")\n    # yaml_data数据传递给\"kwargs\",ids拿到yaml文件中具体的name名称,在运行中显示\n    @pytest.mark.parametrize(\"kwargs\", yaml_data,\n                             ids=[i['apis'][0].get(\"name\") for i in yaml_data])\n    def test_method(self, kwargs, my_fixture):\n        # 添加token和时间戳\n        kwargs = set_token_timestamp(kwargs)  # 设置请求token(可以设置不同角色)\n        # 在yaml文件中添加时间戳\n        # 打印\n        print(\"yaml传输的值\" + str(kwargs))\n        # 实例化日志记录器对象\n        self.logger = Logger()\n        self.logger.info(\"\\n\" + \"测试用例开始执行\".center(120, \"=\"))\n        # 实例化HTTPClient,用于发送请求\n        self.http_client = HTTPClient_A()\n        # 实例化MySQLClient客户端\n        self.mysql_client = MySQLClient()\n    \n        args_dict = {}\n        # 对数据（当前用例）中的所有接口进行调用,所有接口存放在一个列表当中，遍历一次处理每个接口的调用和断言\n        apis = kwargs.get(\"apis\", \"\")\n        for api in apis:\n            # 将api转换很json字符串\n            api = json.dumps(api)\n            \"\"\"\n            将api字符串使用args_dict字典进行格式化\n            类似于\"%(name)s % {\"name\": \"tom\"}\" 这样tom就会被替换到name当中\n            args_dict = {},会在set_args传入形成字典,对yaml中的\"%(asn_code)s\" % {asn_code: xxx}的方式进行传递\n            %这种方式只有在字符串的情况下,才能进行传递,所以要转化\n            \"\"\"\n            # 将api字符串使用args_dict字典进行格式化\n            api = api % args_dict\n            # 将api字符串转换成json格式的数据\n            api = json.loads(api)\n            # print(\"业务流接口\" + str(api))\n    \n            # 调用接口（发送HTTP请求）\n            r = self.http_client.request(**api.get('data'))\n            print(\"响应数值信息: \" + str(r.json()))\n            print(\"status: \" + str(r.status_code))\n            # print(\"code: \" + str(jsonpath(r.json(), \"$..code\")[0]))\n            # 处理断言部分\n            for item in api.get(\"assert\", \"\"):\n                # HTTP状态码断言\n                if item[\"type\"] == \"status\":\n                    assert (r.status_code == item[\"expect\"])\n                # 关键业务信息断言\n                elif item[\"type\"] == \"sys\":\n                    current_value = jsonpath(r.json(), \"$..\" + item['name'])\n                    if current_value:\n>                       assert (current_value[0] == item[\"expect\"])\nE                       AssertionError: assert '角色编号集合不允许为空' == '操作成功'\nE                         - 操作成功\nE                         + 角色编号集合不允许为空\n\ntestcases\\test_A\\test_role\\test_deleteRole.py:67: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"my_fixture","time":{"start":1686643274616,"stop":1686643274616,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert '角色编号集合不允许为空' == '操作成功'\n  - 操作成功\n  + 角色编号集合不允许为空","statusTrace":"self = <testcases.test_A.test_role.test_deleteRole.TestCaseCommon object at 0x000002406DEEB750>\nkwargs = {'apis': [{'assert': [{'expect': 200, 'type': 'status'}, {'expect': '操作成功', 'name': 'message', 'type': 'sys'}], 'data'...name': '批量删除角色 01', 'teardown': [{'sqls': 'update ums_role set is_delete = 0 where id = 6 or id = 7', 'type': 'db'}]}]}\nmy_fixture = None\n\n    @allure.feature(\"测试接口\")\n    # yaml_data数据传递给\"kwargs\",ids拿到yaml文件中具体的name名称,在运行中显示\n    @pytest.mark.parametrize(\"kwargs\", yaml_data,\n                             ids=[i['apis'][0].get(\"name\") for i in yaml_data])\n    def test_method(self, kwargs, my_fixture):\n        # 添加token和时间戳\n        kwargs = set_token_timestamp(kwargs)  # 设置请求token(可以设置不同角色)\n        # 在yaml文件中添加时间戳\n        # 打印\n        print(\"yaml传输的值\" + str(kwargs))\n        # 实例化日志记录器对象\n        self.logger = Logger()\n        self.logger.info(\"\\n\" + \"测试用例开始执行\".center(120, \"=\"))\n        # 实例化HTTPClient,用于发送请求\n        self.http_client = HTTPClient_A()\n        # 实例化MySQLClient客户端\n        self.mysql_client = MySQLClient()\n    \n        args_dict = {}\n        # 对数据（当前用例）中的所有接口进行调用,所有接口存放在一个列表当中，遍历一次处理每个接口的调用和断言\n        apis = kwargs.get(\"apis\", \"\")\n        for api in apis:\n            # 将api转换很json字符串\n            api = json.dumps(api)\n            \"\"\"\n            将api字符串使用args_dict字典进行格式化\n            类似于\"%(name)s % {\"name\": \"tom\"}\" 这样tom就会被替换到name当中\n            args_dict = {},会在set_args传入形成字典,对yaml中的\"%(asn_code)s\" % {asn_code: xxx}的方式进行传递\n            %这种方式只有在字符串的情况下,才能进行传递,所以要转化\n            \"\"\"\n            # 将api字符串使用args_dict字典进行格式化\n            api = api % args_dict\n            # 将api字符串转换成json格式的数据\n            api = json.loads(api)\n            # print(\"业务流接口\" + str(api))\n    \n            # 调用接口（发送HTTP请求）\n            r = self.http_client.request(**api.get('data'))\n            print(\"响应数值信息: \" + str(r.json()))\n            print(\"status: \" + str(r.status_code))\n            # print(\"code: \" + str(jsonpath(r.json(), \"$..code\")[0]))\n            # 处理断言部分\n            for item in api.get(\"assert\", \"\"):\n                # HTTP状态码断言\n                if item[\"type\"] == \"status\":\n                    assert (r.status_code == item[\"expect\"])\n                # 关键业务信息断言\n                elif item[\"type\"] == \"sys\":\n                    current_value = jsonpath(r.json(), \"$..\" + item['name'])\n                    if current_value:\n>                       assert (current_value[0] == item[\"expect\"])\nE                       AssertionError: assert '角色编号集合不允许为空' == '操作成功'\nE                         - 操作成功\nE                         + 角色编号集合不允许为空\n\ntestcases\\test_A\\test_role\\test_deleteRole.py:67: AssertionError","steps":[],"attachments":[{"uid":"c4d145ecb9065436","name":"log","source":"c4d145ecb9065436.txt","type":"text/plain","size":1467}],"parameters":[],"attachmentsCount":1,"shouldDisplayMessage":true,"stepsCount":0,"hasContent":true},"afterStages":[{"name":"my_fixture::0","time":{"start":1686643275102,"stop":1686643275117,"duration":15},"status":"broken","statusMessage":"pymysql.err.OperationalError: (1049, \"Unknown database 'data_operation_open_platform'\")\n","statusTrace":"  File \"C:\\Users\\shaoj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\allure_commons\\_allure.py\", line 221, in __call__\n    return self._fixture_function(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\shaoj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\_pytest\\fixtures.py\", line 918, in _teardown_yield_fixture\n    next(it)\n  File \"C:\\Users\\shaoj\\Desktop\\code\\pytest_testFile\\testcases\\conftest.py\", line 39, in my_fixture\n    mysql_client.execute(item.get(\"sqls\"))\n  File \"C:\\Users\\shaoj\\Desktop\\code\\pytest_testFile\\lib\\different_db\\mysqlclient_A.py\", line 38, in execute\n    with pymysql.connect(host=self.host,\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\shaoj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\pymysql\\connections.py\", line 352, in __init__\n    self.connect()\n  File \"C:\\Users\\shaoj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\pymysql\\connections.py\", line 636, in connect\n    self._request_authentication()\n  File \"C:\\Users\\shaoj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\pymysql\\connections.py\", line 911, in _request_authentication\n    auth_packet = self._read_packet()\n                  ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\shaoj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\pymysql\\connections.py\", line 729, in _read_packet\n    packet.raise_for_error()\n  File \"C:\\Users\\shaoj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\pymysql\\protocol.py\", line 221, in raise_for_error\n    err.raise_mysql_exception(self._data)\n  File \"C:\\Users\\shaoj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\pymysql\\err.py\", line 143, in raise_mysql_exception\n    raise errorclass(errno, errval)\n","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":true,"stepsCount":0,"hasContent":true}],"labels":[{"name":"feature","value":"测试接口"},{"name":"parentSuite","value":"testcases.test_A.test_role"},{"name":"suite","value":"test_deleteRole"},{"name":"subSuite","value":"TestCaseCommon"},{"name":"host","value":"admin"},{"name":"thread","value":"12684-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"testcases.test_A.test_role.test_deleteRole"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"kwargs","value":"{'apis': [{'name': '批量删除角色 01', 'data': {'path': '/ums/role/deleteRole', 'method': 'post', 'headers': None, 'json': {'roleNoList': [6, 7], 'timestamp': None}}, 'assert': [{'type': 'status', 'expect': 200}, {'type': 'sys', 'name': 'message', 'expect': '操作成功'}], 'teardown': [{'type': 'db', 'sqls': 'update ums_role set is_delete = 0 where id = 6 or id = 7'}]}]}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"60b5b7dedd7454f9.json","parameterValues":["{'apis': [{'name': '批量删除角色 01', 'data': {'path': '/ums/role/deleteRole', 'method': 'post', 'headers': None, 'json': {'roleNoList': [6, 7], 'timestamp': None}}, 'assert': [{'type': 'status', 'expect': 200}, {'type': 'sys', 'name': 'message', 'expect': '操作成功'}], 'teardown': [{'type': 'db', 'sqls': 'update ums_role set is_delete = 0 where id = 6 or id = 7'}]}]}"]}